<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="inchworms RGSoC">
    <meta name="keywords" content="inchworms, rails girls, summer of code, open source, sinatra, farm subsidy">
    <meta name="author" content="inchworms_">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="alternate" type="application/rss+xml" title="inchworms" href="http://inchworms.net/blog/feed.xml">
    <link rel="shortcut icon" href="/faviconStatic.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>inch by inch</title>
    <script type="text/javascript" src="/javascripts/d3.v3.js">
    </script>
    <!-- <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.1.3"></script> -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <a href="/blog" class="">
          <img src="http://25.media.tumblr.com/aab70fec3abd0a9a6b9f1803621aabc0/tumblr_mn2s5hgPpX1qlpk58o1_400.gif" alt="inchworm" height="84" width="100" style="position:relative; top:5px; float:right;">   
          <h1>inchworms</h1></a>
          <h2>Summer of Coding, one inch at a time...</h2>
              
        </header>
   
        <section id="main_content">
                <article class="main_content">
    <h1>Our first Geomap</h1>
      <p class='meta'>
        
          <a href='http://twitter.com/inchworms_'>inchworms</a> -
        
        <time datetime="Thu 15 August, 2013">Thu 15 August, 2013</time>
        <span style="float:right">
          <a href="https://twitter.com/share" class="twitter-share-button" data-text="Our first Geomap" data-via="inchworms_" data-hashtags="rgsoc" data-count="none">Tweet</a></span>
<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        
      </p>
      <p>We spent half the morning trying to get the printer driver to run and print with Anja&#39;s computer (to print our eurocamp-ticket). Well we didn&#39;t succeed. After what seemed like an hour Carla tried to print from her computer, which usually works but siehe da, the printer was out of color.
Well trolled!</p>

<p>So we don&#39;t have a printed <a href="http://2013.eurucamp.org/">eurocamp</a> ticket but we hope they&#39;ll let us in tomorrow anyway!</p>

<p>Then we went on with the book. Today we proceed with the chapter about geomapping. It gave us some really nice <a href="http://bl.ocks.org/mbostock/3711652">examples</a> of how to draw a map with d3.</p>

<p>Then we draw our first map. Coincidentally the data from the book are reports of agricultural productivity in the USA during the year 2004. Fits perfectly with our next project. This time it took only about half an hour to get the tooltips working, but we didn&#39;t get the coloring working like it should (it works on localhost but not here), grrrrrh!</p>

<div id="geo_mapping_usa" ></div>

<script type="text/javascript">

      //Width and height
      var w = 700;
      var h = 500;

      //Define map projection
      var projection = d3.geo.albersUsa()
                   .translate([w/2, h/2])
                   .scale([700]);

      //Define path generator
      var path = d3.geo.path()
               .projection(projection);

      var div = d3.select("body").append("div")
          .attr("class", "tooltip_geomapping")
          .style("opacity", 0);
               
      //Define quantize scale to sort data values into buckets of color
      var color_geo_map = d3.scale.quantize()
                .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
                //Colors taken from colorbrewer.js, included in the D3 download

      //Create SVG element
      var svg = d3.select("#geo_mapping_usa")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

      //Load in agriculture data
      d3.csv("/data/us-ag-productivity-2004.csv", function(data) {

        //Set input domain for color scale
        color_geo_map.domain([
          d3.min(data, function(d) { return d.value; }), 
          d3.max(data, function(d) { return d.value; })
        ]);

        //Load in GeoJSON data
        d3.json("/data/us-states.json", function(json) {

          //Merge the ag. data and GeoJSON
          //Loop through once for each ag. data value
          for (var i = 0; i < data.length; i++) {

            //Grab state name
            var dataState = data[i].state;
            
            //Grab data value, and convert from string to float
            var dataValue = parseFloat(data[i].value);

            //Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {

              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {

                //Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                //Stop looking through the JSON
                break;

              }
            }
          }

          //Bind data and create one path per GeoJSON feature
          svg.selectAll("path")
             .data(json.features)
             .enter()
             .append("path")
             .attr("d", path)
             .style("stroke", 'rgb(0,104,55)')
             .style("fill", function(d) {
                //Get data value
                var value = d.properties.value;

                if (value) {
                  //If value exists…
                  return color_geo_map(value);
                } else {
                  //If value is undefined…
                  return "#ccc";
                }
              })
             .on("mouseover", function(d) {
                div
                    .transition()
                    .duration(200)
                    .style("opacity", .9);
                div
                    .html(d.properties.name)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
              })
              .on("mouseout", function(d) {
                div
                  .transition()
                  .duration(500)
                . style("opacity", 0);
             });

        });

      });

    </script>

      <p><img src="../../images/hr.png" style="50% 0 no-repeat"></p>
    </article>


        </section>

        <footer>
          inchworms is maintained by <a href="https://github.com/carlad">carlad</a> & <a href="https://github.com/tyranja">tyranja</a> as part of their <a href="http://railsgirlssummerofcode.org">Rails Girls Summer of Code</a> team project.<br>
          An <a href="http://inchworms.net/blog/feed.xml">RSS feed</a> is available. You can also follow inchworms on <a href="https://twitter.com/inchworms_">twitter</a>.<br> 
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.<br>
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41825288-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

          <!-- Start of StatCounter Code for Default Guide -->
              <script type="text/javascript">
                var sc_project=9035219; 
                var sc_invisible=1; 
                var sc_security="4db3485e"; 
                var scJsHost = (("https:" == document.location.protocol) ?
                "https://secure." : "http://www.");
                document.write("<sc"+"ript type='text/javascript' src='" +
                scJsHost+
                "statcounter.com/counter/counter.js'></"+"script>");
              </script>
              <noscript>
                <div class="statcounter"><a title="web counter"
                  href="http://statcounter.com/free-hit-counter/"
                  target="_blank"><img class="statcounter"
                  src="http://c.statcounter.com/9035219/0/4db3485e/1/"
                  alt="web counter"></a></div>
            </noscript>
              <!-- End of StatCounter Code for Default Guide -->

      </div>
    </div>
  </body>
</html>
