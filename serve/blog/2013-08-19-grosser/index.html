<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="inchworms RGSoC">
    <meta name="keywords" content="inchworms, rails girls, summer of code, open source, sinatra, farm subsidy">
    <meta name="author" content="inchworms_">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="alternate" type="application/rss+xml" title="inchworms" href="http://inchworms.net/blog/feed.xml">
    <link rel="shortcut icon" href="/faviconStatic.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>inch by inch</title>
    <script type="text/javascript" src="/javascripts/d3.v3.js">
    </script>
    <!-- <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.1.3"></script> -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <a href="/blog" class="">
          <img src="http://25.media.tumblr.com/aab70fec3abd0a9a6b9f1803621aabc0/tumblr_mn2s5hgPpX1qlpk58o1_400.gif" alt="inchworm" height="84" width="100" style="position:relative; top:5px; float:right;">   
          <h1>inchworms</h1></a>
          <h2>Summer of Coding, one inch at a time...</h2>
              
        </header>
   
        <section id="main_content">
                <article class="main_content">
    <h1>Germany ist Grosser</h1>
      <p class='meta'>
        
          <a href='http://twitter.com/inchworms_'>inchworms</a> -
        
        <time datetime="Mon 19 August, 2013">Mon 19 August, 2013</time>
        <span style="float:right">
          <a href="https://twitter.com/share" class="twitter-share-button" data-text="Germany ist Grosser" data-via="inchworms_" data-hashtags="rgsoc" data-count="none">Tweet</a></span>
<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        
      </p>
      <p>Today we were feeling ambitious. So after finishing refactoring our Sinatra tests, we decided to take our D3 learnings and make some maps of Europe.</p>

<p>First we needed to find the <a href="http://en.wikipedia.org/wiki/Shapefile">shapefiles</a> for our chosen countries (Carla chose the Czech Republic, Anja went with Germany). We found them on the <a href="http://gadm.org/">Global Administrative Areas</a> website. </p>

<p>Then we had to convert our shapefiles into GeoJSON files, a format that D3 can work with. We did this using something called <strong>gdal</strong>, then running the <strong>ogr2ogr</strong> command on our downloaded <strong>.shp</strong> file (details of exactly how to install this software can be found in <a href="http://shop.oreilly.com/product/0636920026938.do">Interactive Data Visualization</a> on p233).</p>

<p>Once we had this the next challenge was to work out how to properly use the D3 <strong>projection</strong> function. We didn&#39;t realise it was important to pass latitude and longitude coordinates for where the centre of the map should be (in Anja&#39;s case, 50 and 10, in Carla&#39;s 48 and 15). From there, scaling and colouring the maps was easy as we could use the same code from our previous US example. </p>

<p>CRUCIALLY: We also need to wrap each of our maps in seperate functions:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    (function() {
            *code goes here*
    })()
</code></pre></div>
<p>This helps keep any confusion with variable name conflicts in check.</p>

<p>Here is the Czech Republic, with regions in the tooltips:</p>

<div id="geo_mapping_cz" style="height: 250px;"></div>

<script type="text/javascript">
(function() {

    //Width and height
    var wcz = 620;
    var hcz = 350;

    //Easy colors accessible via a 10-step ordinal scale
    var czech_color = d3.scale.category10();

    //div set up
    var div = d3.select("body").append("div")   
      .attr("class", "tooltip_geomapping")               
      .style("opacity", 0);

    //Define map projection
    var projection = d3.geo.mercator()
    .center([15, 49])
    .scale(16000)
    .translate([wcz / 2, hcz / 2]);

    //Define path generator
    var path = d3.geo.path()
                     .projection(projection);

    //Create SVG element
    var svg = d3.select("#geo_mapping_cz")
                .append("svg")
                .attr("width", wcz)
                .attr("height", hcz);

    //Load in GeoJSON data
    d3.json("/data/CZE_adm1.json", function(json) {
        
        //Bind data and create one path per GeoJSON feature
        svg.selectAll("path")
           .data(json.features)
           .enter()
           .append("path")
           .attr("d", path)
           .style("fill", function(d, i) {
            return czech_color(i);
        })
           .style("stroke", 'rgb(256,256,256)')
            .on("mouseover", function(d) {      
          div
              .transition()        
              .duration(200)      
              .style("opacity", .9);      
          div
              .html(d.properties.NAME_1)
              .style("left", (d3.event.pageX) + "px")     
              .style("top", (d3.event.pageY - 28) + "px");    
        })                  
        .on("mouseout", function(d) {       
          div
            .transition()        
            .duration(500)      
            .style("opacity", 0);   
       });

    });
})()
</script>

<p>But Germany is bigger ;-)</p>

<div id="geo_mapping_de" style="margin-top: -160px;"></div>

<script type="text/javascript">
(function() {
    //Width and height
    var w2 = 620;
    var h2 = 800;
    var color_germany = d3.scale.category10();     //builtin range of colors
    //Define default path generator
    var path_de = d3.geo.path()
         .projection(d3.geo.mercator()
        .center([10, 52])
        .scale(16000)
        .translate([w2/2, h2/2]));
    var div = d3.select("body").append("div")
            .attr("class", "tooltip_geomapping")
            .style("opacity", 0);

    //Create SVG element
    var svg_de = d3.select("#geo_mapping_de")
                .append("svg")
                .attr("width", w2)
                .attr("height", h2);

    //Load in GeoJSON data
    d3.json("/data/country_germany_states.json", function(json) {
        
        //Bind data and create one path per GeoJSON feature
        svg_de.selectAll("path")
          .data(json.features)
          .enter()
          .append("path")
          .attr("d", path_de)
          .style("fill", function(d, i) { return color_germany(i); })
            .style("stroke", 'rgb(256,256,256)')
            .on("mouseover", function(d) {
                div
                        .transition()
                    .duration(200)
                    .style("opacity", .9);
                div
                        .html(d.properties.NAME_1)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })                  
                .on("mouseout", function(d) {
                div
                    .transition()
                .duration(500)
              .style("opacity", 0);
                });
    });
})()
</script>

      <p><img src="../../images/hr.png" style="50% 0 no-repeat"></p>
    </article>


        </section>

        <footer>
          inchworms is maintained by <a href="https://github.com/carlad">carlad</a> & <a href="https://github.com/tyranja">tyranja</a> as part of their <a href="http://railsgirlssummerofcode.org">Rails Girls Summer of Code</a> team project.<br>
          An <a href="http://inchworms.net/blog/feed.xml">RSS feed</a> is available. You can also follow inchworms on <a href="https://twitter.com/inchworms_">twitter</a>.<br> 
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.<br>
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41825288-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

          <!-- Start of StatCounter Code for Default Guide -->
              <script type="text/javascript">
                var sc_project=9035219; 
                var sc_invisible=1; 
                var sc_security="4db3485e"; 
                var scJsHost = (("https:" == document.location.protocol) ?
                "https://secure." : "http://www.");
                document.write("<sc"+"ript type='text/javascript' src='" +
                scJsHost+
                "statcounter.com/counter/counter.js'></"+"script>");
              </script>
              <noscript>
                <div class="statcounter"><a title="web counter"
                  href="http://statcounter.com/free-hit-counter/"
                  target="_blank"><img class="statcounter"
                  src="http://c.statcounter.com/9035219/0/4db3485e/1/"
                  alt="web counter"></a></div>
            </noscript>
              <!-- End of StatCounter Code for Default Guide -->

      </div>
    </div>
  </body>
</html>
